@model JWMaps.Models.TerritoryMap

@{
    ViewBag.Title = "TerritoryMapView";
}

<h2>TerritoryMapView</h2>

@{var householders = Model.Householders.ToList(); }

<table id="householders" class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>#ID</th>
            <th>Name</th>
            <th>Address</th>
        </tr>
    </thead>
    <tbody>
        @for(int i = 0 ; i < Model.Householders.Count; i++)
        {
            <tr>
                <td>@(i+1)</td>
                <td>@Html.ActionLink(householders[i].Name, "Edit", "Householders", new { id = householders[i].Id }, null)</td>
                <td>@householders[i].Address</td>
            </tr>
        }
    </tbody>
</table>

<div id="map" style="width: 95%; height: 432px" />


@section scripts
{
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCDXPe6iLZmeOYItmk84ZuV7wVJ_vSQQQs&sensor=false"></script>
    <script type="text/javascript" language="javascript">
        $(document).ready(function () {
            $("#householders").DataTable();

            function initMap() {

                var householders = $(".addr");
                var latitude = @Html.Raw(Json.Encode(Model.Householders.First().Latitude));
                var longitude = @Html.Raw(Json.Encode(Model.Householders.First().Longitude));

                var myLatLng = {lat: latitude, lng: longitude};

                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 17,
                    center: myLatLng
                });

                var bounds = new google.maps.LatLngBounds();
                var labels = '123456789';
                var labelIndex = 0;

                @foreach(var householder in Model.Householders)
                {
                    <text>

                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(@householder.Latitude.ToString().Replace(',', '.') , @householder.Longitude.ToString().Replace(',', '.')),
                        map: map,
                        label: labels[labelIndex++ % labels.length]
                        });
                              
                    bounds.extend(marker.getPosition());                    
                    </text>                    
                }

                map.fitBounds(bounds);

            } google.maps.event.addDomListener(window, 'load', initMap);
        })
    </script>
}

